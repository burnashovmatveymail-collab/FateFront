<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FateFront</title>
<style>
html, body {
  margin: 0;
  height: 100%;
  background: #0e0f12;
  font-family: system-ui;
  overflow: hidden;
}
#hud {
  position: fixed; left: 12px; top: 10px; font-size: 12px; opacity: 0.75;
  background: rgba(0,0,0,0.25); padding: 6px 8px; border-radius: 8px;
}
canvas { display: block; width: 100vw; height: 100vh; }
</style>
</head>
<body>
<div id="hud">pos: 0,0</div>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const hud = document.getElementById('hud');

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener('resize', resize);
resize();

const state = {
  pos: { x: 100, y: 100 },
  mapAngle: 0,
  speed: 200,
  keys: { w:false, a:false, s:false, d:false, left:false, right:false },
  jump: {
    active: false,
    startTime: 0,
    cooldown: 3000,
    lastJump: -9999,
    duration: 900 // 0.9 сек
  }
};

const walls = [
  {x:50,y:50,w:400,h:20},
  {x:50,y:50,w:20,h:300},
  {x:430,y:50,w:20,h:300},
  {x:50,y:330,w:400,h:20},
];
const doors = [
  {x:230,y:50,w:40,h:20,open:false},
];

addEventListener('keydown', e => {
  const k = e.key.toLowerCase();
  if(k==='w') state.keys.w=true;
  if(k==='a') state.keys.a=true;
  if(k==='s') state.keys.s=true;
  if(k==='d') state.keys.d=true;
  if(k==='arrowleft') state.keys.left=true;
  if(k==='arrowright') state.keys.right=true;
  if(k==='arrowup') {
    const now = performance.now();
    if(now - state.jump.lastJump > state.jump.cooldown) {
      state.jump.active = true;
      state.jump.startTime = now;
      state.jump.lastJump = now;
    }
  }
  if(k==='f') {
    doors.forEach(door => {
      const dx = state.pos.x - (door.x + door.w/2);
      const dy = state.pos.y - (door.y + door.h/2);
      const dist = Math.hypot(dx,dy);
      if(dist<50) door.open = !door.open;
    });
  }
});
addEventListener('keyup', e => {
  const k = e.key.toLowerCase();
  if(k==='w') state.keys.w=false;
  if(k==='a') state.keys.a=false;
  if(k==='s') state.keys.s=false;
  if(k==='d') state.keys.d=false;
  if(k==='arrowleft') state.keys.left=false;
  if(k==='arrowright') state.keys.right=false;
});

function update(dt){
  const turnSpeed = 5 * Math.PI / 180; // 5 градусов
  if(state.keys.left) state.mapAngle -= turnSpeed;
  if(state.keys.right) state.mapAngle += turnSpeed;

  const forward = { x: Math.sin(state.mapAngle), y: -Math.cos(state.mapAngle) };
  const right = { x: Math.cos(state.mapAngle), y: Math.sin(state.mapAngle) };

  let dx=0, dy=0;
  if(state.keys.w){ dx+=forward.x*state.speed*dt; dy+=forward.y*state.speed*dt; }
  if(state.keys.s){ dx-=forward.x*state.speed*dt; dy-=forward.y*state.speed*dt; }
  if(state.keys.a){ dx-=right.x*state.speed*dt; dy-=right.y*state.speed*dt; }
  if(state.keys.d){ dx+=right.x*state.speed*dt; dy+=right.y*state.speed*dt; }

  const newX = state.pos.x + dx;
  const newY = state.pos.y + dy;
  const playerSize = 16;
  let collision=false;
  [...walls,...doors.filter(d=>!d.open)].forEach(rect=>{
    if(newX+playerSize>rect.x && newX-playerSize<rect.x+rect.w &&
       newY+playerSize>rect.y && newY-playerSize<rect.y+rect.h) collision=true;
  });
  if(!collision){ state.pos.x=newX; state.pos.y=newY; }

  hud.innerHTML=`pos: ${state.pos.x.toFixed(1)}, ${state.pos.y.toFixed(1)}`;
}

function getJumpScale() {
  if(!state.jump.active) return 1;
  const t = performance.now() - state.jump.startTime;
  const p = t / state.jump.duration;
  if(p >= 1) {
    state.jump.active = false;
    return 1;
  }
  // Реалистичный прыжок: быстрый вверх, пауза, медленное падение
  if(p < 0.3) { // взлёт
    return 1 + 0.2 * (p/0.3);
  } else if(p < 0.4) { // пауза
    return 1.2;
  } else { // падение
    const fallP = (p-0.4)/0.6;
    return 1.2 - 0.2*fallP;
  }
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const cx = canvas.width/2;
  const cy = canvas.height/2;

  const scale = getJumpScale();

  ctx.save();
  ctx.translate(cx, cy);
  ctx.scale(1/scale, 1/scale); // карта уменьшается, игрок кажется больше
  ctx.rotate(-state.mapAngle);
  ctx.translate(-state.pos.x, -state.pos.y);

  // стены
  ctx.fillStyle='#7c7f85';
  walls.forEach(w=>ctx.fillRect(w.x,w.y,w.w,w.h));

  // двери
  ctx.fillStyle='#f59e0b';
  doors.forEach(d=>{ if(!d.open) ctx.fillRect(d.x,d.y,d.w,d.h); });

  ctx.restore();

  // игрок
  ctx.save();
  ctx.translate(cx, cy);
  ctx.scale(scale, scale);
  ctx.fillStyle='#4ade80';
  ctx.beginPath();
  ctx.moveTo(0, -16);
  ctx.lineTo(12, 16);
  ctx.lineTo(-12, 16);
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}

function loop(){
  requestAnimationFrame(loop);
  const dt=1/60;
  update(dt);
  draw();
}
requestAnimationFrame(loop);
</script>
</body>
</html>
