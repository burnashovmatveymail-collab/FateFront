<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FateFront</title>
<style>
html, body {
  margin: 0;
  height: 100%;
  background: #0e0f12;
  font-family: system-ui;
  overflow: hidden;
}
#hud {
  position: fixed; left: 12px; top: 10px; font-size: 12px; opacity: 0.75;
  background: rgba(0,0,0,0.25); padding: 6px 8px; border-radius: 8px;
}
canvas { display: block; width: 100vw; height: 100vh; }
</style>
</head>
<body>
<div id="hud">pos: 0,0</div>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const hud = document.getElementById('hud');

function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
}
addEventListener('resize', resize);
resize();

const state = {
  pos: { x: 100, y: 100 },
  mapAngle: 0,
  speed: 200,
  keys: { w:false, a:false, s:false, d:false, left:false, right:false, up:false },
  jumping: false,
  jumpScale: 1,
  lastJump: 0
};

// --- СТЕНЫ карты (только реальные стены!) ---
const walls = [
  {x:0, y:0, w:1200, h:20},
  {x:0, y:580, w:1200, h:20},
  {x:0, y:0, w:20, h:600},
  {x:1180, y:0, w:20, h:600},

  // Пример комнат
  {x:300, y:150, w:20, h:300},
  {x:600, y:100, w:20, h:200},
  {x:850, y:300, w:20, h:200}
];

// --- Точки закладки бомбы (только краска на полу) ---
const bombSites = [
  {x:200, y:400, size:50, name:"A"},
  {x:800, y:150, size:50, name:"B"}
];

// --- Спавны ---
const spawns = {
  counter: {x:80, y:150, r:30},    // спецназ (синий)
  terrorist: {x:1050, y:500, r:30} // террористы (оранжевый)
};

addEventListener('keydown', e => {
  const k = e.key.toLowerCase();
  if(k==='w') state.keys.w=true;
  if(k==='a') state.keys.a=true;
  if(k==='s') state.keys.s=true;
  if(k==='d') state.keys.d=true;
  if(k==='arrowleft') state.keys.left=true;
  if(k==='arrowright') state.keys.right=true;
  if(k==='arrowup') {
    const now = performance.now()/1000;
    if(now - state.lastJump > 3 && !state.jumping) {
      state.jumping = true;
      state.jumpStart = now;
      state.lastJump = now;
    }
  }
});
addEventListener('keyup', e => {
  const k = e.key.toLowerCase();
  if(k==='w') state.keys.w=false;
  if(k==='a') state.keys.a=false;
  if(k==='s') state.keys.s=false;
  if(k==='d') state.keys.d=false;
  if(k==='arrowleft') state.keys.left=false;
  if(k==='arrowright') state.keys.right=false;
});

function update(dt){
  const turnSpeed = 5 * Math.PI / 180;
  if(state.keys.left) state.mapAngle -= turnSpeed;
  if(state.keys.right) state.mapAngle += turnSpeed;

  const forward = { x: Math.sin(state.mapAngle), y: -Math.cos(state.mapAngle) };
  const right = { x: Math.cos(state.mapAngle), y: Math.sin(state.mapAngle) };

  let dx=0, dy=0;
  if(state.keys.w){ dx+=forward.x*state.speed*dt; dy+=forward.y*state.speed*dt; }
  if(state.keys.s){ dx-=forward.x*state.speed*dt; dy-=forward.y*state.speed*dt; }
  if(state.keys.a){ dx-=right.x*state.speed*dt; dy-=right.y*state.speed*dt; }
  if(state.keys.d){ dx+=right.x*state.speed*dt; dy+=right.y*state.speed*dt; }

  const newX = state.pos.x + dx;
  const newY = state.pos.y + dy;
  const playerSize = 16;
  let collision=false;
  walls.forEach(rect=>{
    if(newX+playerSize>rect.x && newX-playerSize<rect.x+rect.w &&
       newY+playerSize>rect.y && newY-playerSize<rect.y+rect.h) collision=true;
  });
  if(!collision){ state.pos.x=newX; state.pos.y=newY; }

  // прыжок (как было в базе!)
  if(state.jumping){
    const t = performance.now()/1000 - state.jumpStart;
    if(t<0.9){
      state.jumpScale = 1 + Math.sin(t/0.9 * Math.PI) * 0.5;
    } else {
      state.jumping=false;
      state.jumpScale=1;
    }
  }

  hud.innerHTML=`pos: ${state.pos.x.toFixed(1)}, ${state.pos.y.toFixed(1)}`;
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const cx = canvas.width/2;
  const cy = canvas.height/2;

  ctx.save();
  ctx.translate(cx, cy);
  ctx.scale(state.jumpScale, state.jumpScale); 
  ctx.rotate(-state.mapAngle);
  ctx.translate(-state.pos.x, -state.pos.y);

  // стены
  ctx.fillStyle='#7c7f85';
  walls.forEach(w=>ctx.fillRect(w.x,w.y,w.w,w.h));

  // бомбы (краска на полу)
  bombSites.forEach(site=>{
    ctx.fillStyle='rgba(255,0,0,0.3)';
    ctx.beginPath();
    ctx.arc(site.x, site.y, site.size, 0, Math.PI*2);
    ctx.fill();
    ctx.fillStyle='white';
    ctx.fillText(site.name, site.x-4, site.y+4);
  });

  // спавны
  ctx.fillStyle='rgba(37,99,235,0.4)'; // синий
  ctx.beginPath();
  ctx.arc(spawns.counter.x, spawns.counter.y, spawns.counter.r, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle='rgba(249,115,22,0.4)'; // оранжевый
  ctx.beginPath();
  ctx.arc(spawns.terrorist.x, spawns.terrorist.y, spawns.terrorist.r, 0, Math.PI*2);
  ctx.fill();

  ctx.restore();

  // игрок
  ctx.save();
  ctx.translate(cx, cy);
  ctx.fillStyle='#4ade80';
  ctx.beginPath();
  ctx.moveTo(0, -16);
  ctx.lineTo(12, 16);
  ctx.lineTo(-12, 16);
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}

function loop(){
  requestAnimationFrame(loop);
  const dt=1/60;
  update(dt);
  draw();
}
requestAnimationFrame(loop);
</script>
</body>
</html>
